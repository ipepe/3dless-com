THREE.SimplifyModifier=function(){},function(){function e(e,o){-1===e.indexOf(o)&&e.push(o)}function o(e,o){var t=e.indexOf(o);t>-1&&e.splice(t,1)}function t(e,o){var t,i,s,r=o.position.distanceTo(e.position),n=0,h=[],a=(e.faces,e.faces.length);for(t=0;t<a;t++)i=e.faces[t],i.hasVertex(o)&&h.push(i);for(t=0;t<a;t++){var f=1;i=e.faces[t];for(var c=0;c<h.length;c++){s=h[c];var v=i.normal.dot(s.normal);f=Math.min(f,(1.001-v)/2)}n=Math.max(n,f)}return h.length<2&&(n=1),r*n+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var o=0;o<e.neighbors.length;o++){var i=t(e,e.neighbors[o]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[o],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[o],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function s(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){o(e.neighbors.pop().neighbors,e)}o(t,e)}function r(e,t){o(t,e),e.v1&&o(e.v1.faces,e),e.v2&&o(e.v2.faces,e),e.v3&&o(e.v3.faces,e);for(var i,s,r=[this.v1,this.v2,this.v3],n=0;n<3;n++)i=r[n],s=r[(n+1)%3],i&&s&&(i.removeIfNonNeighbor(s),s.removeIfNonNeighbor(i))}function n(e,o,t,n){if(!n)return void s(t,e);var h,a=[];for(h=0;h<t.neighbors.length;h++)a.push(t.neighbors[h]);for(h=t.faces.length-1;h>=0;h--)t.faces[h].hasVertex(n)&&r(t.faces[h],o);for(h=t.faces.length-1;h>=0;h--)t.faces[h].replaceVertex(t,n);for(s(t,e),h=0;h<a.length;h++)i(a[h])}function h(e){for(var o=e[0],t=0;t<e.length;t++)e[t].collapseCost<o.collapseCost&&(o=e[t]);return o}function a(e,o,t,i,s,r){this.a=i,this.b=s,this.c=r,this.v1=e,this.v2=o,this.v3=t,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(o),e.addUniqueNeighbor(t),o.faces.push(this),o.addUniqueNeighbor(e),o.addUniqueNeighbor(t),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(o)}function f(e,o){this.position=e,this.id=o,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}var c=new THREE.Vector3,v=new THREE.Vector3;a.prototype.computeNormal=function(){var e=this.v1.position,o=this.v2.position,t=this.v3.position;c.subVectors(t,o),v.subVectors(e,o),c.cross(v).normalize(),this.normal.copy(c)},a.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},a.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),o(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},f.prototype.addUniqueNeighbor=function(o){e(this.neighbors,o)},f.prototype.removeIfNonNeighbor=function(e){var o=this.neighbors,t=this.faces,i=o.indexOf(e);if(-1!==i){for(var s=0;s<t.length;s++)if(t[s].hasVertex(e))return;o.splice(i,1)}},THREE.SimplifyModifier.prototype.modify=function(e,o){e instanceof THREE.BufferGeometry&&!e.vertices&&!e.faces?(console.log("converting BufferGeometry to Geometry"),e=(new THREE.Geometry).fromBufferGeometry(e)):e=e.clone(),e.mergeVertices(),o=e.vertices.length-o;var t,s,r,c=e.vertices,v=e.faces,l=(new THREE.Geometry,new Array(c.length)),g=new Array(v.length);for(t=0,s=c.length;t<s;t++)l[t]=new f(c[t],t);for(t=0,s=v.length;t<s;t++)r=v[t],g[t]=new a(l[r.a],l[r.b],l[r.c],r.a,r.b,r.c);for(t=0,s=l.length;t<s;t++)i(l[t]);for(var u,p=(new Array(l.length),new Array(l.length),o);p--;){if(!(u=h(l))){console.log("no next vertex");break}n(l,g,u,u.collapseNeighbor)}var b=new THREE.Geometry;for(t=0;t<l.length;t++){var N=l[t];b.vertices.push(N.position)}for(t=0;t<g.length;t++){var d=g[t];b.faces.push(new THREE.Face3(l.indexOf(d.v1),l.indexOf(d.v2),l.indexOf(d.v3)))}return b}}();